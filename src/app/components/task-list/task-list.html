<div class="task-list-container">
  <div class="header">
    <h1>My Tasks</h1>
    <div class="header-actions">
      <button 
        class="btn btn-secondary" 
        (click)="onRefresh()"
        
        title="Refresh tasks">
        ğŸ”„ Refresh
      </button>
      <button 
        class="btn btn-primary" 
        (click)="openCreateModal()"
        >
        + Create Task
      </button>
    </div>
  </div>

  <div class="task-stats" >
    <div class="stat-item stat-info">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <span class="stat-label">Total</span>
        <span class="stat-value">{{ stats.total }}</span>
      </div>
    </div>
    <div class="stat-item stat-todo">
      <div class="stat-icon">ğŸ“‹</div>
      <div class="stat-content">
        <span class="stat-label">Todo</span>
        <span class="stat-value">{{ stats.todo }}</span>
      </div>
    </div>
    <div class="stat-item stat-doing">
      <div class="stat-icon">âš¡</div>
      <div class="stat-content">
        <span class="stat-label">Doing</span>
        <span class="stat-value">{{ stats.doing }}</span>
      </div>
    </div>
    <div class="stat-item stat-done">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <span class="stat-label">Done</span>
        <span class="stat-value">{{ stats.done }}</span>
      </div>
    </div>
    <div class="stat-item stat-warning">
      <div class="stat-icon">âš ï¸</div>
      <div class="stat-content">
        <span class="stat-label">Overdue</span>
        <span class="stat-value">{{ stats.overdue }}</span>
      </div>
    </div>
    <div class="stat-item stat-success">
      <div class="stat-icon">ğŸ¯</div>
      <div class="stat-content">
        <span class="stat-label">Completion</span>
        <span class="stat-value">{{ stats.completion_rate }}%</span>
      </div>
    </div>
  </div>

  <div class="message-container">
    <div class="error-message" *ngIf="errorMessage" role="alert">
      <span class="message-icon">âŒ</span>
      <span class="message-text">{{ errorMessage }}</span>
      <button class="message-close" (click)="errorMessage = ''" aria-label="Close">&times;</button>
    </div>
    
    <div class="success-message" *ngIf="successMessage" role="status">
      <span class="message-icon">âœ…</span>
      <span class="message-text">{{ successMessage }}</span>
      <button class="message-close" (click)="successMessage = ''" aria-label="Close">&times;</button>
    </div>
  </div>

  <div class="tasks" *ngIf=" hasTasks">
    <div 
      class="task-card" 
      *ngFor="let task of tasks; trackBy: trackByTaskId" 
      [class.completed]="task.state === State.DONE"
      [class.overdue]="isOverdue(task)"
      [class.in-progress]="task.state === State.DOING">

      <div class="overdue-badge" *ngIf="isOverdue(task)">
        âš ï¸ Overdue
      </div>

      <div class="task-header">
        <div class="task-checkbox-wrapper">
          <input 
            type="checkbox" 
            [checked]="task.state === State.DONE" 
            (change)="toggleComplete(task, $event)"
            [id]="'task-checkbox-' + task.id"
            class="task-checkbox"
            >
          <label [for]="'task-checkbox-' + task.id" class="checkbox-label"></label>
        </div>
        
        <div class="task-title-wrapper">
          <h3 class="task-title" [class.completed]="task.state === State.DONE">
            {{ task.title }}
          </h3>
          <div class="task-badges">
            <span 
              class="task-state-badge" 
              [class]="getStateInfo(task.state).class"
              [title]="'Click to change to ' + getNextState(task.state)"
              (click)="toggleTaskState(task)">
              {{ getStateInfo(task.state).icon }} {{ getStateInfo(task.state).label }}
            </span>
            <span 
              class="task-tag-badge" 
              *ngIf="task.tag"
              [class]="getTagClass(task.tag)">
              {{ task.tag }}
            </span>
          </div>
        </div>
      </div>

      <p class="task-description" *ngIf="task.description">
        {{ task.description }}
      </p>

      <div class="task-meta">
        <div class="meta-item">
          <span class="meta-icon">ğŸ“…</span>
          <span class="meta-text">
            <strong>Created:</strong> {{ task.created_on | date:'short' }}
          </span>
        </div>
        <div class="meta-item" *ngIf="task.due_date">
          <span class="meta-icon" [class.overdue-icon]="isOverdue(task)">
            {{ isOverdue(task) ? 'âš ï¸' : 'ğŸ•’' }}
          </span>
          <span class="meta-text" [class.overdue-text]="isOverdue(task)">
            <strong>Due:</strong> {{ task.due_date | date:'short' }}
          </span>
        </div>
      </div>

      <div class="task-actions">
        <button 
          class="btn btn-sm btn-state" 
          (click)="toggleTaskState(task)"
          
          [title]="'Change to ' + getNextState(task.state)">
          {{ getStateInfo(getNextState(task.state)).icon }} Next: {{ getStateInfo(getNextState(task.state)).label }}
        </button>
        <button 
          class="btn btn-sm btn-secondary" 
          (click)="openEditModal(task)"
          >
          âœï¸ Edit
        </button>
        <button 
          class="btn btn-sm btn-danger" 
          (click)="deleteTask(task.id!)"
          >
          ğŸ—‘ï¸ Delete
        </button>
      </div>
    </div>
  </div>


  <div class="empty-state" *ngIf=" !hasTasks">
    <div class="empty-icon">ğŸ“‹</div>
    <h3>No tasks yet</h3>
    <p>Create your first task to get started!</p>
    <button class="btn btn-primary btn-lg" (click)="openCreateModal()">
      + Create Your First Task
    </button>
  </div>

  <div class="pagination" *ngIf="totalPages > 1 ">
    <button 
      class="btn btn-sm btn-pagination" 
      [disabled]="currentPage === 1" 
      (click)="goToPage(currentPage - 1)"
      aria-label="Previous page">
      â† Previous
    </button>
    
    <div class="pagination-info">
      <span class="page-indicator">
        Page <strong>{{ currentPage }}</strong> of <strong>{{ totalPages }}</strong>
      </span>
      <span class="record-count">
        ({{ totalRecords }} {{ totalRecords === 1 ? 'task' : 'tasks' }})
      </span>
    </div>
    
    <button 
      class="btn btn-sm btn-pagination" 
      [disabled]="currentPage === totalPages" 
      (click)="goToPage(currentPage + 1)"
      aria-label="Next page">
      Next â†’
    </button>
  </div>

  <app-task-form 
    *ngIf="showModal" 
    [task]="editingTask" 
    (close)="closeModal()" 
    (saved)="onTaskSaved()">
  </app-task-form>
</div>